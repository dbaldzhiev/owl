# OWL â€” Technical Requirements Document (TRD)

**Target Platform**: Rhino 8 / Grasshopper (.NET 7 Plugin)
**Language**: C#
**API**: RhinoCommon (`Rhino.Geometry`), Grasshopper (`Grasshopper.Kernel`)
**Domain**: Auditoriums, Cinemas, Grandstands, Tribune Renovation
**Structure**:
-   `Owl.Core`: Pure C# logic, geometry generation, data structures. No GH dependencies.
-   `Owl.Grasshopper`: GH Components, UI logic, parameter handling.

---

## 0. Core Design Principle
The plugin is structured as a collection of Grasshopper components that mimic a node-based workflow.

Data flows: `Setup Objects` (Params) -> `Solver Components` -> `Geometry/Analysis Data`.

---

## 1. Components & Data Structures

### 1.1 Tribune Setup
**Component Name**: `Owl_TribuneSetup`
**Category**: Owl.Setup
**Purpose**: Define the base dimensions and stepping logic of the tribune.

**Inputs**:
-   `Row Count` (int): Number of elevated rows.
-   `Row Depth` (float): Depth of a single row module.
-   `Row Elevation Steps` (list[int]): List of step counts per row (e.g., [2, 2, 2] means each row rises by 2 steps).

**Outputs**:
-   `TribuneSetup`: A data object containing the above configuration.

### 1.2 Stairs Setup
**Component Name**: `Owl_StairSetup`
**Category**: Owl.Setup
**Purpose**: Define the dimensions of the steps (risers and treads).

**Inputs**:
-   `Riser Height` (float): Height of one riser.
-   `Tread Depth` (float): Depth of one tread step.

**Outputs**:
-   `StairSetup`: A data object containing step dimensions.

### 1.3 Railings Setup
**Component Name**: `Owl_RailingSetup`
**Category**: Owl.Setup
**Purpose**: Define railing dimensions.

**Inputs**:
-   `Rail Height` (float): Height of the railing above the nose of the tread.
-   `Rail Thickness` (float): Width/Thickness of the railing.

**Outputs**:
-   `RailingSetup`: A data object containing railing dimensions.

### 1.4 Tribune Solver
**Component Name**: `Owl_TribuneSolver`
**Category**: Owl.Solvers
**Purpose**: Generate the 3D geometry based on the setup objects.

**Inputs**:
-   `TribuneSetup`
-   `StairSetup`
-   `RailingSetup`

**Outputs**:
-   `Tribune Geometry` (Brep/Mesh): The 3D geometry of the tribune.
-   `Stairs Geometry` (Brep/Mesh): The 3D geometry of the stairs/aisles.
-   `Railings Geometry` (Brep/Mesh): The 3D geometry of the railings.
-   `Analysis Data`: Data for use in analysis/validation.

---

## 2. Implemented Components (Previously Placeholders)

### 2.1 Audience Setup
**Component Name**: `Owl_AudienceSetup`
**Category**: Owl.Setup
**Purpose**: Define occupant parameters (eye height, head height, seating preference).

### 2.2 Recliner Chair
**Component Name**: `Owl_ReclinerChair`
**Category**: Owl.Setup
**Purpose**: Define dimensions and mechanics of recliner seats.

### 2.3 Screen Setup
**Component Name**: `Owl_ScreenSetup`
**Category**: Owl.Setup
**Purpose**: Define cinema screen geometry (width, height, curvature, position).

### 2.4 Projector Setup
**Component Name**: `Owl_ProjectorSetup`
**Category**: Owl.Setup
**Purpose**: Define projector location and cone parameters.

### 2.5 Validator / Analysis
**Component Name**: `Owl_Validator`
**Category**: Owl.Solvers
**Purpose**: Calculate C-values, verify sightlines, and validate geometry against safety standards.

---

## 3. Geometry Logic (Solver)

-   **Tribune Profile**:
    -   Starts at origin or specified plane.
    -   Advances by `Row Depth`.
    -   Rises by `Elevation Steps * Riser Height`.
    -   Maintains monotonic elevation.

-   **Stairs Profile**:
    -   Aligned to tribune rows but subdivided into `Tread Depth` and `Riser Height` steps.
    -   Ensures safe walking path.

-   **Railings**:
    -   Placed at row edges or designated safety zones.
    -   Height measured from nosing line.

---

## 4. Coding Standards

-   **C# / .NET 7**: Modern C# features (records, nullable reference types) encouraged.
-   **RhinoCommon**: Primary geometry library.
-   **No External Dependencies**: Minimize external libraries unless necessary for specific features (e.g., JSON serialization).
-   **Performance**: Logic should be optimized for real-time interaction in Grasshopper.

---

## 5. Testing Requirements (Mandatory)
-   **Implementation**: A dedicated NUnit test project (`Owl.Core.Tests`) is required.
-   **Scope**: Extensive, verbose unit tests covering all Core logic.
-   **Coverage**:
    -   Valid inputs (Standard cases).
    -   Edge cases (Nulls, Zero values, Empty lists).
    -   Transformations (Flip, Origin shifts).
    -   Data Consistency (Plan vs Section match).
-   **Style**: Tests should be detailed and self-explanatory. Both happy paths and failure modes must be verified.
